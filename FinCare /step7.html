<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Step 7: Final Permission - FinCARE</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDGeRJkrzIjtM51OFu8_58nAlxAof0QK98",
            authDomain: "fincare-project-4015e.firebaseapp.com",
            databaseURL: "https://fincare-project-4015e-default-rtdb.firebaseio.com",
            projectId: "fincare-project-4015e",
            storageBucket: "fincare-project-4015e.firebasestorage.app",
            messagingSenderId: "415209492661",
            appId: "1:415209492661:web:683ea15a1e177fb4c52efc",
            measurementId: "G-DNG4ZMXG1J"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, (user) => {
            if (!user) window.location.href = "login.html";
        });

        async function completeOnboarding() {
            const user = auth.currentUser;
            const checkbox = document.getElementById('auth-check');
            const finishBtn = document.getElementById('finishBtn');

            if (!checkbox.checked) {
                alert("Please authorize the AI engine to continue.");
                return;
            }

            finishBtn.innerText = "Activating AI...";
            finishBtn.disabled = true;

            try {
                const userRef = doc(db, "users", user.uid);
                await updateDoc(userRef, {
                    onboardingComplete: true,
                    isAIAuthorized: true,
                    currentStep: 7,
                    lastUpdated: new Date()
                });
                // Redirect to Dashboard
                window.location.href = "dashboard.html";
            } catch (error) {
                console.error("Error finishing onboarding:", error);
                alert("Error saving your choice. Please try again.");
                finishBtn.innerText = "Finish & Enter Dashboard";
                finishBtn.disabled = false;
            }
        }
        window.completeOnboarding = completeOnboarding;
    </script>

    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#f2cc0d",
                        "background-dark": "#000000",
                    },
                    fontFamily: { "display": ["Manrope", "sans-serif"] },
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        body { font-family: 'Manrope', sans-serif; background-color: #000; }
        .ios-blur { backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        .checkbox-custom:checked + label .check-box { background-color: #f2cc0d; border-color: #f2cc0d; }
    </style>
</head>
<body class="text-white font-display overflow-x-hidden">
<div class="relative flex min-h-screen w-full flex-col bg-black max-w-md mx-auto shadow-2xl">
    <div class="flex items-center p-4 pt-8 justify-center sticky top-0 z-10">
        <h2 class="text-primary text-[10px] font-bold uppercase tracking-[0.3em]">Step 7 of 7</h2>
    </div>

    <div class="flex flex-col gap-2 px-8 mt-4">
        <div class="flex justify-between items-end">
            <span class="text-white/40 text-[10px] font-bold uppercase tracking-[0.2em]">Onboarding Status</span>
            <span class="text-primary text-xs font-black tracking-tighter">100%</span>
        </div>
        <div class="rounded-full bg-white/5 h-1.5 w-full overflow-hidden border border-white/5">
            <div class="h-full rounded-full bg-primary shadow-[0_0_20px_rgba(242,204,13,0.8)]" style="width: 100%;"></div>
        </div>
    </div>

    <main class="flex-1 px-8 pt-12 flex flex-col items-center text-center">
        <div class="size-20 bg-primary/10 border border-primary/20 rounded-3xl flex items-center justify-center mb-8 shadow-[0_0_30px_rgba(242,204,13,0.1)]">
            <span class="material-symbols-outlined text-primary text-4xl font-variation-fill">verified_user</span>
        </div>
        
        <h1 class="text-white tracking-tight text-4xl font-extrabold leading-tight">FINAL STEP:<br><span class="text-primary italic">YOUR PERMISSION</span></h1>
        <p class="text-white/50 text-base mt-6 leading-relaxed">To activate your AI-driven income forecasting engine, we need your authorization to securely analyze your data.</p>

        <div class="w-full mt-12 p-6 rounded-[2rem] bg-white/[0.03] border border-white/10 text-left">
            <div class="flex gap-4">
                <div class="relative flex items-start pt-1">
                    <input id="auth-check" type="checkbox" class="checkbox-custom hidden"/>
                    <label for="auth-check" class="cursor-pointer">
                        <div class="check-box size-6 rounded-lg border-2 border-white/20 transition-all flex items-center justify-center">
                            <span class="material-symbols-outlined text-black text-sm font-bold">check</span>
                        </div>
                    </label>
                </div>
                <div>
                    <p class="text-white text-sm font-bold leading-tight">I acknowledge the Terms of Service and authorize the secure processing of financial data for AI predictive modeling.</p>
                    <p class="text-primary text-[10px] font-black uppercase tracking-widest mt-2">Required for Income Insights</p>
                </div>
            </div>
        </div>

        <div class="w-full mt-6 space-y-3">
            <div class="flex items-center justify-between p-5 rounded-2xl bg-white/[0.02] border border-white/5">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-white/40">policy</span>
                    <span class="text-white/60 text-sm font-bold">Privacy Policy</span>
                </div>
                <span class="material-symbols-outlined text-white/20">chevron_right</span>
            </div>
            <div class="flex items-center justify-between p-5 rounded-2xl bg-white/[0.02] border border-white/5">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-white/40">security</span>
                    <span class="text-white/60 text-sm font-bold">Security Framework</span>
                </div>
                <span class="material-symbols-outlined text-white/20">chevron_right</span>
            </div>
        </div>
    </main>

    <footer class="p-8 mt-auto">
        <button id="finishBtn" onclick="completeOnboarding()" class="w-full bg-primary hover:brightness-110 active:scale-[0.97] text-black font-black text-lg h-16 rounded-2xl flex items-center justify-center gap-3 transition-all shadow-[0_12px_40px_rgba(242,204,13,0.3)]">
            FINISH & ENTER DASHBOARD
            <span class="material-symbols-outlined font-bold">rocket_launch</span>
        </button>
        <div class="mt-6 flex flex-col items-center gap-2">
            <div class="flex items-center gap-2 opacity-30">
                <span class="material-symbols-outlined text-xs">lock</span>
                <p class="text-[9px] font-black uppercase tracking-[0.2em]">Bank-Grade AES-256 Encryption</p>
            </div>
            <div class="h-1.5 w-32 bg-white/10 rounded-full mt-2"></div>
        </div>
    </footer>
</div>
</body>
</html>
